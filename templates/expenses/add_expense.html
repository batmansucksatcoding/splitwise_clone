{% extends "base.html" %}
{% load static %}
{% block title %}Add Expense | Splitwise{% endblock %}

{% block content %}
<div class="add-expense-page">
  <div class="add-expense-card">
    <div class="card-header">
      <div class="icon-wrapper">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 5H5C3.89543 5 3 5.89543 3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V7C21 5.89543 20.1046 5 19 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 15H7.01M11 15H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h1 class="page-title">Add a New Expense</h1>
      <p class="page-subtitle">Record and split expenses among your group members</p>
    </div>

    <form method="POST" id="expense-form">
      {% csrf_token %}

      <!-- Display form errors/messages -->
      {% if messages %}
        <div class="messages-container">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                {% if message.tags == 'error' %}
                  <path d="M12 8V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                {% else %}
                  <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                {% endif %}
              </svg>
              <span>{{ message }}</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Title -->
      <div class="form-group">
        <label for="title">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.50023C18.8978 2.1024 19.4374 1.87891 20 1.87891C20.5626 1.87891 21.1022 2.1024 21.5 2.50023C21.8978 2.89805 22.1213 3.43762 22.1213 4.00023C22.1213 4.56284 21.8978 5.1024 21.5 5.50023L12 15.0002L8 16.0002L9 12.0002L18.5 2.50023Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Expense Title
        </label>
        <input type="text" id="title" name="title" placeholder="e.g. Dinner at Olive Bistro" required value="{{ request.POST.title|default:'' }}">
      </div>

      <!-- Amount -->
      <div class="form-group">
        <label for="amount">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 1V23M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Amount
        </label>
        <div class="input-with-prefix">
          <span class="input-prefix">₹</span>
          <input type="number" step="0.01" id="amount" name="amount" placeholder="0.00" required oninput="validateSplit()" value="{{ request.POST.amount|default:'' }}">
        </div>
      </div>
      <!-- Date -->
      <div class="form-group">
        <label for="date">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 7V3M16 7V3M3 11H21M5 21H19C20.1046 21 21 20.1046 21 19V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Date
        </label>
        <input type="date" id="date" name="date" required value="{{ request.POST.date|default:today }}">
      </div>

      <!-- Group -->
      <div class="form-group">
        <label for="group">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89317 18.7122 8.75608 18.1676 9.45768C17.623 10.1593 16.8604 10.6597 16 10.88M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Select Group
        </label>
        <select id="group" name="group" required onchange="updateMembers()">
          <option value="">Choose a Group</option>
          {% for group in groups %}
            <option value="{{ group.id }}" 
                    {% if selected_group == group.id|stringformat:"s" or request.POST.group == group.id|stringformat:"s" %}selected{% endif %}
                    data-members='[
              {% for member in group.members.all %}
                {"id": "{{ member.id }}", "username": "{{ member.username }}"}{% if not forloop.last %},{% endif %}
              {% endfor %}
            ]'>{{ group.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Paid By -->
      <div class="form-group">
        <label for="paid_by">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 6.21071 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Paid By
        </label>
        <select id="paid_by" name="paid_by" required>
          <option value="">Select Member</option>
        </select>
      </div>

      <!-- Split Type -->
      <div class="form-group">
        <label>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 21L16.65 16.65M11 8V11L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Split Type
        </label>
        <div class="split-type-cards">
          <label class="split-card {% if not request.POST.split_type or request.POST.split_type == 'equal' %}active{% endif %}">
            <input type="radio" name="split_type" value="equal" {% if not request.POST.split_type or request.POST.split_type == 'equal' %}checked{% endif %} onchange="updateSplitFields()">
            <div class="split-card-content">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 12H19M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Split Equally</span>
            </div>
          </label>
          <label class="split-card {% if request.POST.split_type == 'unequal' %}active{% endif %}">
            <input type="radio" name="split_type" value="unequal" {% if request.POST.split_type == 'unequal' %}checked{% endif %} onchange="updateSplitFields()">
            <div class="split-card-content">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2V22M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Unequal Amounts</span>
            </div>
          </label>
          <label class="split-card {% if request.POST.split_type == 'percentage' %}active{% endif %}">
            <input type="radio" name="split_type" value="percentage" {% if request.POST.split_type == 'percentage' %}checked{% endif %} onchange="updateSplitFields()">
            <div class="split-card-content">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 5L5 19M8 5C8 6.65685 6.65685 8 5 8C3.34315 8 2 6.65685 2 5C2 3.34315 3.34315 2 5 2C6.65685 2 8 3.34315 8 5ZM22 19C22 20.6569 20.6569 22 19 22C17.3431 22 16 20.6569 16 19C16 17.3431 17.3431 16 19 16C20.6569 16 22 17.3431 22 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>By Percentage</span>
            </div>
          </label>
        </div>
      </div>

      <!-- Participants -->
      <div class="form-group">
        <label>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 11C11.2091 11 13 9.20914 13 7C13 4.79086 11.2091 3 9 3C6.79086 3 5 4.79086 5 7C5 9.20914 6.79086 11 9 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 21V19C3 17.9391 3.42143 16.9217 4.17157 16.1716C4.92172 15.4214 5.93913 15 7 15H11C12.0609 15 13.0783 15.4214 13.8284 16.1716C14.5786 16.9217 15 17.9391 15 19V21M16 11H22M19 8V14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Who is part of this expense?
        </label>
        <div id="participants" class="participant-list">
          <div class="empty-participants">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p class="hint">Select a group first to see members</p>
          </div>
        </div>
      </div>

      <!-- Dynamic Split Fields -->
      <div class="form-group" id="split-values" style="display:none;">
        <label>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 7H20M4 12H20M4 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Enter Split Values
        </label>
        <div id="split-fields"></div>
        <div id="split-warning" class="alert-warning" style="display:none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span id="split-warning-text"></span>
        </div>
      </div>

      <!-- Description -->
      <div class="form-group">
        <label for="description">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14 2V8H20M16 13H8M16 17H8M10 9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Description <span class="optional">(optional)</span>
        </label>
        <textarea id="description" name="description" rows="3" placeholder="Add a short note about this expense...">{{ request.POST.description|default:'' }}</textarea>
      </div>

      <!-- Buttons -->
      <div class="form-buttons">
        <button type="submit" class="btn btn-primary" id="submit-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Add Expense</span>
        </button>
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<script>
let membersCache = [];

function updateMembers() {
  const groupSelect = document.getElementById("group");
  const selectedOption = groupSelect.options[groupSelect.selectedIndex];

  // Parse members safely
  let members = [];
  try {
    members = JSON.parse(selectedOption?.dataset?.members || "[]");
  } catch (e) {
    console.warn("Invalid members data:", e);
    members = [];
  }

  membersCache = members; // ✅ store for later use

  const participantsDiv = document.getElementById("participants");
  const paidBySelect = document.getElementById("paid_by");

  participantsDiv.innerHTML = "";
  paidBySelect.innerHTML = '<option value="">Select Member</option>';

  if (members.length === 0) {
    participantsDiv.innerHTML = `
      <div class="empty-participants">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p class="hint">No members found for this group</p>
      </div>`;
    return;
  }

  // ✅ Populate "Paid By" dropdown
  members.forEach(member => {
    const option = document.createElement("option");
    option.value = member.id;
    option.textContent = member.username;
    paidBySelect.appendChild(option);
  });

  // ✅ Populate "Participants" checkbox list
  members.forEach(member => {
    const label = document.createElement("label");
    label.className = "participant-option";

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.name = "user_ids[]";
    checkbox.value = member.id;
    checkbox.onchange = updateSplitFields;

    const span = document.createElement("span");
    span.textContent = " " + member.username;

    label.appendChild(checkbox);
    label.appendChild(span);
    participantsDiv.appendChild(label);
  });

  updateSplitFields();
}


function updateSplitFields() {
  const splitTypeInputs = document.querySelectorAll('input[name="split_type"]');
  let splitType = 'equal';
  splitTypeInputs.forEach(input => {
    if (input.checked) {
      splitType = input.value;
      input.closest('.split-card').classList.add('active');
    } else {
      input.closest('.split-card').classList.remove('active');
    }
  });

  const participants = document.querySelectorAll('input[name="user_ids[]"]:checked');
  const splitDiv = document.getElementById("split-values");
  const splitFields = document.getElementById("split-fields");
  const warning = document.getElementById("split-warning");

  splitFields.innerHTML = "";
  warning.style.display = "none";

  if (splitType === "unequal" || splitType === "percentage") {
    splitDiv.style.display = "block";

    const colors = ['#6dd5ed', '#2193b0', '#a8e6cf', '#ffd3a5', '#c7ceea'];

    participants.forEach((p, index) => {
      const member = membersCache.find(m => m.id === p.value);
      const username = member ? member.username : "Unknown";
      const symbol = splitType === "unequal" ? "₹" : "%";
      const color = colors[index % colors.length];

      const container = document.createElement("div");
      container.classList.add("split-item");
      container.innerHTML = `
        <div class="split-item-header">
          <span class="participant-avatar-small" style="background: ${color}">
            ${username.charAt(0).toUpperCase()}
          </span>
          <span class="split-item-name">${username}</span>
        </div>
        <div class="input-with-suffix">
          <input type="number" step="0.01" name="split_value_${p.value}" 
                 placeholder="0.00" oninput="validateSplit()" required>
          <span class="input-suffix">${symbol}</span>
        </div>
      `;
      splitFields.appendChild(container);
    });
  } else {
    splitDiv.style.display = "none";
  }
}


function validateSplit() {
  const splitType = document.querySelector('input[name="split_type"]:checked').value;
  const total = parseFloat(document.getElementById("amount").value || 0);
  const inputs = document.querySelectorAll('#split-fields input');
  const warning = document.getElementById("split-warning");
  const warningText = document.getElementById("split-warning-text");

  let sum = 0;
  inputs.forEach(i => sum += parseFloat(i.value || 0));

  if (splitType === "unequal" && Math.abs(sum - total) > 0.01 && sum > 0) {
    warning.style.display = "flex";
    warningText.textContent = `Total amounts (₹${sum.toFixed(2)}) must equal ₹${total.toFixed(2)}`;
  } else if (splitType === "percentage" && Math.abs(sum - 100) > 0.01 && sum > 0) {
    warning.style.display = "flex";
    warningText.textContent = `Total percentages (${sum.toFixed(2)}%) must equal 100%`;
  } else {
    warning.style.display = "none";
  }
}


document.getElementById('expense-form').addEventListener('submit', function(e) {
  const submitBtn = document.getElementById('submit-btn');
  const btnText = submitBtn.querySelector('span');
  
  const participants = document.querySelectorAll('input[name="user_ids[]"]:checked');
  if (participants.length === 0) {
    e.preventDefault();
    alert('Please select at least one participant!');
    return false;
  }

  const splitType = document.querySelector('input[name="split_type"]:checked').value;
  if (splitType !== 'equal') {
    const total = parseFloat(document.getElementById("amount").value || 0);
    const inputs = document.querySelectorAll('#split-fields input');
    let sum = 0;
    inputs.forEach(i => sum += parseFloat(i.value || 0));

    if (splitType === "unequal" && Math.abs(sum - total) > 0.01) {
      e.preventDefault();
      alert('Split amounts must equal the total expense amount!');
      return false;
    } else if (splitType === "percentage" && Math.abs(sum - 100) > 0.01) {
      e.preventDefault();
      alert('Split percentages must total 100%!');
      return false;
    }
  }

  submitBtn.disabled = true;
  btnText.textContent = 'Adding...';
  submitBtn.style.opacity = '0.7';
});


document.addEventListener('DOMContentLoaded', function() {
  const groupSelect = document.getElementById('group');
  if (groupSelect.value) updateMembers();
});
</script>


<style>
/* === Page Layout === */
.add-expense-page {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 40px 20px;
  position: relative;
  overflow: hidden;
}

.add-expense-page::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  animation: float 20s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  50% { transform: translate(-20px, 20px) rotate(5deg); }
}

/* === Card === */
.add-expense-card {
  width: 100%;
  max-width: 650px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2);
  padding: 0;
  animation: slideUp 0.6s ease-out;
  position: relative;
  z-index: 1;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(40px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* === Header === */
.card-header {
  text-align: center;
  padding: 40px 40px 30px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 24px 24px 0 0;
  color: white;
}

.icon-wrapper {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 64px;
  height: 64px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  margin-bottom: 1rem;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.icon-wrapper svg {
  color: white;
}

.page-title {
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: white;
}

.page-subtitle {
  color: rgba(255, 255, 255, 0.9);
  font-size: 0.95rem;
  margin: 0;
}

/* === Form === */
form {
  padding: 40px;
}

.form-group {
  margin-bottom: 1.75rem;
}

label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: #374151;
  font-size: 0.95rem;
}

label svg {
  color: #667eea;
  flex-shrink: 0;
}

.optional {
  color: #9ca3af;
  font-weight: 400;
  font-size: 0.85rem;
}

/* === Inputs === */
input[type="text"],
input[type="number"],
select,
textarea {
  width: 100%;
  padding: 12px 16px;
  background: #f9fafb;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  font-size: 1rem;
  color: #111827;
  transition: all 0.3s ease;
  font-family: inherit;
}

input[type="text"]:focus,
input[type="number"]:focus,
select:focus,
textarea:focus {
  background: white;
  border-color: #667eea;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  outline: none;
}

input::placeholder,
textarea::placeholder {
  color: #9ca3af;
}

textarea {
  resize: vertical;
  min-height: 80px;
}

/* === Input with Prefix/Suffix === */
.input-with-prefix,
.input-with-suffix {
  position: relative;
  display: flex;
  align-items: center;
}

.input-prefix,
.input-suffix {
  position: absolute;
  font-weight: 600;
  color: #6b7280;
  font-size: 1rem;
  pointer-events: none;
}

.input-prefix {
  left: 16px;
}

.input-suffix {
  right: 16px;
}

.input-with-prefix input {
  padding-left: 36px;
}

.input-with-suffix input {
  padding-right: 40px;
}

/* === Split Type Cards === */
.split-type-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.75rem;
  margin-top: 0.75rem;
}

.split-card {
  position: relative;
  cursor: pointer;
  margin: 0;
}

.split-card input[type="radio"] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.split-card-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 16px 12px;
  background: #f9fafb;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  transition: all 0.3s ease;
}

.split-card-content svg {
  color: #6b7280;
  transition: color 0.3s ease;
}

.split-card-content span {
  font-weight: 600;
  font-size: 0.85rem;
  color: #374151;
  text-align: center;
}

.split-card:hover .split-card-content {
  background: #f3f4f6;
  border-color: #d1d5db;
}

.split-card.active .split-card-content {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
  border-color: #667eea;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.split-card.active .split-card-content svg {
  color: #667eea;
}

.split-card.active .split-card-content span {
  color: #667eea;
}

/* === Participants === */
.participant-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 0.75rem;
  margin-top: 0.75rem;
}

.empty-participants {
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 1rem;
  background: #f9fafb;
  border: 2px dashed #e5e7eb;
  border-radius: 12px;
}

.empty-participants svg {
  color: #d1d5db;
  margin-bottom: 1rem;
}

.hint {
  color: #9ca3af;
  font-size: 0.9rem;
  margin: 0;
}

.participant-item {
  background: #f9fafb;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  padding: 12px;
  transition: all 0.3s ease;
}

.participant-item:hover {
  background: white;
  border-color: #d1d5db;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.participant-item label {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin: 0;
  cursor: pointer;
  font-weight: 500;
}

.participant-item input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  margin: 0;
  accent-color: #667eea;
}

.participant-avatar {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  color: white;
  font-weight: 700;
  font-size: 0.9rem;
  flex-shrink: 0;
}

.participant-name {
  flex: 1;
  color: #374151;
}

/* === Split Items === */
.split-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  padding: 12px 16px;
  background: #f9fafb;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  margin-bottom: 0.75rem;
  transition: all 0.3s ease;
}

.split-item:hover {
  background: white;
  border-color: #d1d5db;
}

.split-item-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1;
}

.participant-avatar-small {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  color: white;
  font-weight: 700;
  font-size: 0.85rem;
  flex-shrink: 0;
}

.split-item-name {
  font-weight: 600;
  color: #374151;
  font-size: 0.95rem;
}

.split-item .input-with-suffix {
  width: 120px;
}

.split-item input {
  padding: 8px 40px 8px 12px;
  font-size: 0.95rem;
}

/* === Alert === */
.alert-warning {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 12px 16px;
  background: #fef3c7;
  border: 2px solid #fbbf24;
  border-radius: 12px;
  margin-top: 1rem;
  animation: shake 0.5s ease;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.alert-warning svg {
  color: #f59e0b;
  flex-shrink: 0;
}

.alert-warning span {
  color: #92400e;
  font-size: 0.9rem;
  font-weight: 500;
}

/* === Buttons === */
.form-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 2.5rem;
  padding-top: 2rem;
  border-top: 2px solid #f3f4f6;
}

.btn {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 14px 24px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 1rem;
  text-align: center;
  text-decoration: none;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: inherit;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
}

.btn-primary:active {
  transform: translateY(0);
}

.btn-secondary {
  background: #f9fafb;
  color: #374151;
  border: 2px solid #e5e7eb;
}

.btn-secondary:hover {
  background: #f3f4f6;
  border-color: #d1d5db;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn-secondary:active {
  transform: translateY(0);
}

/* === Responsive Design === */
@media (max-width: 768px) {
  .add-expense-page {
    padding: 20px;
  }

  .add-expense-card {
    max-width: 100%;
  }

  .card-header {
    padding: 32px 24px 24px;
  }

  form {
    padding: 32px 24px;
  }

  .page-title {
    font-size: 1.5rem;
  }

  .split-type-cards {
    grid-template-columns: 1fr;
  }

  .participant-list {
    grid-template-columns: 1fr;
  }

  .form-buttons {
    flex-direction: column;
  }

  .btn {
    width: 100%;
  }

  .split-item {
    flex-direction: column;
    align-items: stretch;
  }

  .split-item .input-with-suffix {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .icon-wrapper {
    width: 56px;
    height: 56px;
  }

  .icon-wrapper svg {
    width: 28px;
    height: 28px;
  }

  .page-title {
    font-size: 1.3rem;
  }

  .page-subtitle {
    font-size: 0.85rem;
  }

  form {
    padding: 24px 20px;
  }

  label {
    font-size: 0.9rem;
  }

  input[type="text"],
  input[type="number"],
  select,
  textarea {
    font-size: 0.95rem;
    padding: 10px 14px;
  }
}
</style>
{% endblock %}